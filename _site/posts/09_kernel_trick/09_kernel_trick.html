<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Derek Sollberger">
<meta name="dcterms.date" content="2025-09-30">

<title>9: The Kernel Trick – SML 301 Slides</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2f6844b3748638c5738d4cf93630e566.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../../site_libs/d3-3.3.8/d3.min.js"></script>

<script src="../../site_libs/dagre-0.4.0/dagre-d3.min.js"></script>

<link href="../../site_libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">

<script src="../../site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>

<link href="../../site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">

<script src="../../site_libs/chromatography-0.1/chromatography.js"></script>

<script src="../../site_libs/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SML 301 Slides</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Lecture Sessions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#session-9-the-kernel-trick" id="toc-session-9-the-kernel-trick" class="nav-link active" data-scroll-target="#session-9-the-kernel-trick">Session 9: The Kernel Trick</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives:</a></li>
  </ul></li>
  <li><a href="#auroc" id="toc-auroc" class="nav-link" data-scroll-target="#auroc">AUROC</a></li>
  <li><a href="#svm-overview" id="toc-svm-overview" class="nav-link" data-scroll-target="#svm-overview">SVM Overview</a></li>
  <li><a href="#hyperplane" id="toc-hyperplane" class="nav-link" data-scroll-target="#hyperplane">Hyperplane</a>
  <ul class="collapse">
  <li><a href="#separating-hyperplane" id="toc-separating-hyperplane" class="nav-link" data-scroll-target="#separating-hyperplane">Separating Hyperplane</a></li>
  <li><a href="#maximal-margin-classifier" id="toc-maximal-margin-classifier" class="nav-link" data-scroll-target="#maximal-margin-classifier">Maximal Margin Classifier</a></li>
  <li><a href="#mathematics-of-the-mmc" id="toc-mathematics-of-the-mmc" class="nav-link" data-scroll-target="#mathematics-of-the-mmc">Mathematics of the MMC</a></li>
  </ul></li>
  <li><a href="#support-vector-classifiers" id="toc-support-vector-classifiers" class="nav-link" data-scroll-target="#support-vector-classifiers">Support Vector Classifiers</a>
  <ul class="collapse">
  <li><a href="#mathematics-of-the-svc" id="toc-mathematics-of-the-svc" class="nav-link" data-scroll-target="#mathematics-of-the-svc">Mathematics of the SVC</a></li>
  <li><a href="#tuning-parameter" id="toc-tuning-parameter" class="nav-link" data-scroll-target="#tuning-parameter">Tuning Parameter</a></li>
  <li><a href="#nonlinear-classification" id="toc-nonlinear-classification" class="nav-link" data-scroll-target="#nonlinear-classification">Nonlinear Classification</a></li>
  </ul></li>
  <li><a href="#the-kernel-trick" id="toc-the-kernel-trick" class="nav-link" data-scroll-target="#the-kernel-trick">The Kernel Trick</a>
  <ul class="collapse">
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example 1:</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example 2:</a></li>
  </ul></li>
  <li><a href="#support-vector-machines" id="toc-support-vector-machines" class="nav-link" data-scroll-target="#support-vector-machines">Support Vector Machines</a>
  <ul class="collapse">
  <li><a href="#radial-kernels" id="toc-radial-kernels" class="nav-link" data-scroll-target="#radial-kernels">Radial Kernels</a></li>
  <li><a href="#svm-with-radial-kernels" id="toc-svm-with-radial-kernels" class="nav-link" data-scroll-target="#svm-with-radial-kernels">SVM with Radial Kernels</a></li>
  </ul></li>
  <li><a href="#more-than-two-classes" id="toc-more-than-two-classes" class="nav-link" data-scroll-target="#more-than-two-classes">More than Two Classes</a></li>
  <li><a href="#svm-legacy" id="toc-svm-legacy" class="nav-link" data-scroll-target="#svm-legacy">SVM Legacy</a></li>
  <li><a href="#quo-vadimus" id="toc-quo-vadimus" class="nav-link" data-scroll-target="#quo-vadimus">Quo Vadimus?</a></li>
  <li><a href="#footnotes" id="toc-footnotes" class="nav-link" data-scroll-target="#footnotes">Footnotes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">9: The Kernel Trick</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Derek Sollberger </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="session-9-the-kernel-trick" class="level1">
<h1>Session 9: The Kernel Trick</h1>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning objectives:</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Implement a binary classification model using a <strong>maximal margin classifier</strong>.</li>
<li>Implement a binary classification model using a <strong>support vector classifier</strong>.</li>
<li>Implement a binary classification model using a <strong>support vector machine</strong> (SVM).</li>
<li>Generalize SVM models to <strong>multi-class</strong> cases.</li>
</ul>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/svm_protest.png" class="img-fluid figure-img"></p>
<figcaption>support vector machines!</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="auroc" class="level1">
<h1>AUROC</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/roc-curve-v2.png" class="img-fluid figure-img"></p>
<figcaption>area under ROC curves</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://glassboxmedicine.com/2019/02/23/measuring-performance-auc-auroc/">Rachel Draelos</a></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AUROC
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>area under an ROC curve</strong> is a popular metric for classification methods.</p>
<ul>
<li>a user can change the <em>cutoff value</em> and move a decision boundary</li>
<li>for each cutoff value, compute and record the FPR (false positive rate) and TPR (true positive rate)</li>
<li>plot TPR vs FPR</li>
<li>compute the area under the curve: values closer to 1.0 are deemed better models</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DCP1
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
<section id="svm-overview" class="level1">
<h1>SVM Overview</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">MMC to SVM</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Mermaid code</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>Support vector machine (SVM)</strong>, an approach for classification developed in 1990. SVM is a generalizaion of classifiers methods, in particular:</p>
<ul>
<li><strong>maximal margin classifier</strong> (it requires that the classes be separable by a linear boundary).</li>
<li><strong>support vector classifier</strong></li>
<li><strong>support vector machine</strong>: binary classification setting with two classes</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-62caa1e3720de2382076" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-62caa1e3720de2382076">{"x":{"diagram":"\ngraph TB\n  A[SVM<br>support vector machine<br>non-linear class boundaries]\n\n  B[MMC<br>maximal margin classifier<br>linear class boundaries] \n  B-->C[SVC<br>support vector classifier<br>applied in a broader range of cases]\n  A-->C\n\n"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>(optional for this course)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DiagrammR package</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mermaid</span>(<span class="st">"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">graph TB</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">  A[SVM&lt;br&gt;support vector machine&lt;br&gt;non-linear class boundaries]</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">  B[MMC&lt;br&gt;maximal margin classifier&lt;br&gt;linear class boundaries] </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">  B--&gt;C[SVC&lt;br&gt;support vector classifier&lt;br&gt;applied in a broader range of cases]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">  A--&gt;C</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="hyperplane" class="level1">
<h1>Hyperplane</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hyperplane.png" class="img-fluid figure-img"></p>
<figcaption>image credit: Deep AI</figcaption>
</figure>
</div>
<ul>
<li>A <em>hyperplane</em> is a <span class="math inline">\(p-1\)</span>-dimensional flat subspace of a <span class="math inline">\(p\)</span>-dimensional space. For example, in a 2-dimensional space, a hyperplane is a flat one-dimensional space: a line.</li>
<li>(standard form) Definition of 2D hyperplane in 3D space: <span class="math display">\[\beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}X_{3}= 0\]</span></li>
<li>(inner products) Any <span class="math inline">\(X\)</span> s.t. <span class="math inline">\(X = (X_{1}, X_{2})^T\)</span> for which the equation above is satisfied is a point on the hyperplane.</li>
</ul>
<p>Additional resource: <a href="https://deepai.org/machine-learning-glossary-and-terms/hyperplane">Deep AI</a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conceptual Task 1A
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p><em>ISLR</em>, Chapter 9, Conceptual Task 1A</p>
</blockquote>
<p>“This problem involves hyperplanes in two dimensions.”</p>
<ol type="a">
<li>Sketch the hyperplane <span class="math inline">\(1 + 3X_{1} - X_{2} = 0\)</span>. Indicate the set of points for which <span class="math inline">\(1 + 3X_{1} - X_{2} &gt; 0\)</span>, as well as the set of points for which <span class="math inline">\(1 + 3X_{1} - X_{2} &lt; 0\)</span>.</li>
</ol>
<ul>
<li>blue: <span class="math inline">\(1 + 3X_{1} - X_{2} &gt; 0\)</span></li>
<li>red: <span class="math inline">\(1 + 3X_{1} - X_{2} &lt; 0\)</span></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="separating-hyperplane" class="level2">
<h2 class="anchored" data-anchor-id="separating-hyperplane">Separating Hyperplane</h2>
<ul>
<li>Consider a matrix <strong>X</strong> of dimensions <span class="math inline">\(n*p\)</span>, and a <span class="math inline">\(y_{i} \in \{-1, 1\}\)</span>. We have a new observation, <span class="math inline">\(x^*\)</span>, which is a vector <span class="math inline">\(x^* = (x^*_{1}...x^*_{p})^T\)</span> which we wish to classify to one of two groups.</li>
<li>We will use a <em>separating hyperplane</em> to classify the observation.</li>
</ul>
<p><img src="images/fig9_2.png" class="img-fluid"></p>
<ul>
<li>We can label the blue observations as <span class="math inline">\(y_{i} = 1\)</span> and the pink observations as <span class="math inline">\(y_{i} = -1\)</span>.</li>
<li>Thus, a separating hyperplane has the property s.t. <span class="math inline">\(\beta_{0} + \beta_{1}X_{i1} + \beta_{2}X_{i2} ... + \beta_{p}X_{ip} &gt; 0\)</span> if <span class="math inline">\(y_{i} =1\)</span> and <span class="math inline">\(\beta_{0} + \beta_{1}X_{i1} + \beta_{2}X_{i2} ... + \beta_{p}X_{ip} &lt; 0\)</span> if <span class="math inline">\(y_{i} = -1\)</span>.</li>
<li>In other words, a separating hyperplane has the property s.t. <span class="math inline">\(y_{i}(\beta_{0} + \beta_{1}X_{i1} + \beta_{2}X_{i2} ... + \beta_{p}X_{ip}) &gt; 0\)</span> for all <span class="math inline">\(i = 1...n\)</span>.</li>
<li>Consider also the <em>magnitude</em> of <span class="math inline">\(f(x^*)\)</span>. If it is far from zero, we are confident in its classification, whereas if it is close to 0, then <span class="math inline">\(x^*\)</span> is located near the hyperplane, and we are less confident about its classification.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conceptual Task 1B
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p><em>ISLR</em>, Chapter 9, Conceptual Task 1B</p>
</blockquote>
<ol start="2" type="a">
<li>On the same plot, sketch the hyperplane <span class="math inline">\(-2 + X_{1} + 2X_{2} = 0\)</span>. Indicate the set of points for which <span class="math inline">\(-2 + X_{1} + 2X_{2} &gt; 0\)</span>, as well as the set of points for which <span class="math inline">\(-2 + X_{1} + 2X_{2} &lt; 0\)</span>.</li>
</ol>
<ul>
<li>blue: <span class="math inline">\(-2 + X_{1} + 2X_{2} &gt; 0\)</span></li>
<li>red: <span class="math inline">\(-2 + X_{1} + 2X_{2} &lt; 0\)</span></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="maximal-margin-classifier" class="level2">
<h2 class="anchored" data-anchor-id="maximal-margin-classifier">Maximal Margin Classifier</h2>
<p><img src="images/fig9_3.png" class="img-fluid"></p>
<ul>
<li>Generally, if data can be perfectly separated using a hyperplane, an infinite amount of such hyperplanes exist.</li>
<li>An intuitive choice is the <em>maximal margin hyperplane</em>, which is the hyperplane that is farthest from the training data.</li>
<li>We compute the perpendicular distance from each training observation to the hyperplane. The smallest of these distances is known as the <em>margin</em>.</li>
<li>The <em>maximal margin hyperplane</em> is the hyperplane for which the <em>margin</em> is maximized. We can classify a test observation based on which side of the maximal margin hyperplane it lies on, and this is known as the <em>maximal margin classifier</em>.</li>
<li>The maximal margin classifier classifies <span class="math inline">\(x^*\)</span> based on the sign of <span class="math inline">\(f(x^*) = \beta_{0} + \beta_{1}x^*_{1} + ... + \beta_{p}x^*_{p}\)</span>.</li>
</ul>
<p><img src="images/fig9_3.png" class="img-fluid"></p>
<ul>
<li>Note the 3 training observations that lie on the margin and are equidistant from the hyperplane. These are the <strong>support vectors</strong> (vectors in <span class="math inline">\(p\)</span>-dimensional space; in this case <span class="math inline">\(p=2\)</span>).</li>
<li>They support the hyperplane because if their location was changed, the hyperplane would change.</li>
<li>The maximal margin hyperplane depends on these observations, <em>but not the others</em> (unless the other observations were moved at or within the margin).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conceptual Task 3
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  obs xvals yvals class_label
1   1     3     4         Red
2   2     2     2         Red
3   3     4     4         Red
4   4     1     4         Red
5   5     2     1        Blue
6   6     4     3        Blue
7   7     4     1        Blue</code></pre>
</div>
</div>
<ol type="a">
<li>We are given <span class="math inline">\(n = 7\)</span> observations in <span class="math inline">\(p = 2\)</span> dimensions. For each observation, there is an associated class label.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="a">
<li>Sketch the optimal separating hyperplane, and provide the equation for this hyperplane</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="a">
<li></li>
</ol>
<ul>
<li>blue: <span class="math inline">\(0.5 - X_{1} + X_{2} &lt; 0\)</span></li>
<li>red: <span class="math inline">\(0.5 - X_{1} + X_{2} &gt; 0\)</span></li>
</ul>
<ol start="4" type="a">
<li>maximal margin in indicated by the dashed lines, with margin</li>
</ol>
<p><span class="math display">\[M = \frac{0.5}{\sqrt{2}} \approx 0.3536\]</span></p>
<ol start="5" type="a">
<li>Indicate the support vectors for the maximal margin classifier.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="6" type="a">
<li><p>Argue that a slight movement of the seventh observation would not affect the maximal margin hyperplane.</p></li>
<li><p>Sketch a hyperplane that is not the optimal separating hyperplane, and provide the equation for this hyperplane.</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="8" type="a">
<li>Draw an additional observation on the plot so that the two classes are no longer separable by a hyperplane.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mathematics-of-the-mmc" class="level2">
<h2 class="anchored" data-anchor-id="mathematics-of-the-mmc">Mathematics of the MMC</h2>
<ul>
<li>Consider constructing an MMC based on the training observations <span class="math inline">\(x_{1}...x_{n} \in \mathbb{R}^p\)</span>. This is the solution to the optimization problem:</li>
</ul>
<p><span class="math display">\[\text{max}_{\beta_{0}...\beta_{p}, M} \space M\]</span> <span class="math display">\[\text{subject to } \sum_{j=1}^{p}\beta_{j}^2 = 1\]</span> <span class="math display">\[y_{i}(\beta_{0} + \beta_{1}X_{i1} + \beta_{2}X_{i2} ... + \beta_{p}X_{ip}) \geq M \quad \forall i = 1...n\]</span></p>
<ul>
<li><span class="math inline">\(M\)</span> is the <em>margin</em>, and the <span class="math inline">\(\beta\)</span> coeffients are chosen to maximize <span class="math inline">\(M\)</span>.</li>
<li>The constraint (3rd equation) ensures that each observation will be correctly classified, as long as M is positive.</li>
</ul>
<p><img src="images/fig9_3.png" class="img-fluid"></p>
<ul>
<li>The 2nd and 3rd equations ensure that each data point is on the correct side of the hyperplane and at least M-distance away from the hyperplane.</li>
<li>The perpendicular distance to the hyperplane is given by <span class="math inline">\(y_{i}(\beta_{0} + \beta_{1}x_{i1} + \beta_{2}x_{i2} ... + \beta_{p}x_{ip})\)</span>.</li>
</ul>
<blockquote class="blockquote">
<p>But what if our data is not separable by a linear hyperplane?</p>
</blockquote>
<p><img src="images/fig9_4.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Individual data points greatly affect formation of the maximal margin classifier</p>
</blockquote>
<p><img src="images/fig9_5.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DCP2
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
</section>
<section id="support-vector-classifiers" class="level1">
<h1>Support Vector Classifiers</h1>
<ul>
<li>We can’t always use a hyperplane to separate two classes.</li>
<li>Even if such a classifier does exist, it’s not always desirable, due to overfitting or too much sensitivity to individual observations.</li>
<li>Thus, it might be worthwhile to consider a classifier/hyperplane that misclassifies a few observations in order to improve classification of the remaining data points.</li>
<li>The <em>support vector classifier</em>, a.k.a the <em>soft margin classifier</em>, allows some training data to be on the wrong side of the margin or even the hyperplane.</li>
</ul>
<section id="mathematics-of-the-svc" class="level2">
<h2 class="anchored" data-anchor-id="mathematics-of-the-svc">Mathematics of the SVC</h2>
<ul>
<li>The SVC classifies a test observation based on which side of the hyperplane it lies.</li>
</ul>
<p><span class="math display">\[\text{max}_{\beta_{0}...\beta_{p}, \epsilon_{1}...\epsilon_{n}, M} \space M\]</span> <span class="math display">\[\text{subject to } \sum_{j=1}^{p}\beta_{j}^2 = 1\]</span> <span class="math display">\[y_{i}(\beta_{0} + \beta_{1}X_{i1} + \beta_{2}X_{i2} ... + \beta_{p}X_{ip}) \geq M(1 - \epsilon_{i})\]</span> <span class="math display">\[\epsilon_{i} \geq 0, \quad \sum_{i=1}^{n}\epsilon_{i} \leq C\]</span></p>
<ul>
<li><p><span class="math inline">\(C\)</span> is a nonnegative tuning parameter, typically chosen through cross-validation, and can be thought of as the budget for margin violation by the observations.</p></li>
<li><p>The <span class="math inline">\(\epsilon_{i}\)</span> are <em>slack variables</em> that allow individual observations to be on the wrong side of the margin or hyperplane. The <span class="math inline">\(\epsilon_{i}\)</span> indicates where the <span class="math inline">\(i^{\text{th}}\)</span> observation is located with regards to the margin and hyperplane.</p>
<ul>
<li>If <span class="math inline">\(\epsilon_{i} = 0\)</span>, the observation is on the correct side of the margin.</li>
<li>If <span class="math inline">\(\epsilon_{i} &gt; 0\)</span>, the observation is on the wrong side of margin</li>
<li>If <span class="math inline">\(\epsilon_{i} &gt; 1\)</span>, the observation is on the wrong side of the hyperplane.</li>
</ul></li>
<li><p>Since <span class="math inline">\(C\)</span> constrains the sum of the <span class="math inline">\(\epsilon_{i}\)</span>, it determines the number and magnitude of violations to the margin. If <span class="math inline">\(C=0\)</span>, there is no margin for violation, thus all the <span class="math inline">\(\epsilon_{1},...,\epsilon_{n} = 0\)</span>.</p></li>
<li><p>Note that if <span class="math inline">\(C&gt;0\)</span>, no more than <span class="math inline">\(C\)</span> observations can be on wrong side of hyperplane, since in these cases <span class="math inline">\(\epsilon_{i} &gt; 1\)</span>.</p></li>
</ul>
</section>
<section id="tuning-parameter" class="level2">
<h2 class="anchored" data-anchor-id="tuning-parameter">Tuning Parameter</h2>
<p><img src="images/fig9_7.png" class="img-fluid"></p>
<ul>
<li><p>A property of the classifier is that only data points which lie on or violate the margin will affect the hyperplane. These data points are known as <em>support vectors</em>.</p></li>
<li><p><span class="math inline">\(C\)</span> controls the bias-variance tradeoff of the classifier.</p>
<ul>
<li>When <span class="math inline">\(C\)</span> is large: high bias, low variance</li>
<li>When <span class="math inline">\(C\)</span> is small: low bias, high variance</li>
</ul></li>
<li><p>The property of the SVC solely being dependent on certain observations in classification differs from other classification methods such as LDA (depends on mean of all observations in each class, as well as each class’s covariance matrix using all observations).</p></li>
<li><p>However, logistic regression is more similar to SVC in that it has low sensitivity to observations far from the decision boundary.</p></li>
</ul>
</section>
<section id="nonlinear-classification" class="level2">
<h2 class="anchored" data-anchor-id="nonlinear-classification">Nonlinear Classification</h2>
<ul>
<li>Many decision boundaries are not linear.</li>
<li>We could fit an SVC to the data using <span class="math inline">\(2p\)</span> features (in the case of <span class="math inline">\(p\)</span> features and using a quadratic form).</li>
</ul>
<p><span class="math display">\[X_{1}, X_{1}^{2}, \quad X_{2}, X_{2}^{2}, \quad\cdots, \quad X_{p}, X_{p}^{2}\]</span></p>
<p><span class="math display">\[\text{max}_{\beta_{0},\beta_{11},\beta_{12},\dots,\beta_{p1},\beta_{p2} \epsilon_{1},\dots,\epsilon_{n}, M} \space M\]</span> <span class="math display">\[\text{subject to }  y_{i}\left(\beta_{0} + \sum_{j=1}^{p} \beta_{ji}x_{ji} + \sum_{j=1}^{p} \beta_{ji}x_{ji}^{2}\right) \geq M(1 - \epsilon_{i})\]</span></p>
<p><span class="math display">\[\epsilon_{i} \geq 0, \quad \sum_{i=1}^{n}\epsilon_{i} \leq C, \quad \sum_{j=1}^{p}\sum_{k=1}^{2} \beta_{jk}^{2} = 1\]</span></p>
<ul>
<li>Note that in the enlarged feature space (here, with the quadratic terms), the decision boundary is linear. But in the original feature space, it is quadratic <span class="math inline">\(q(x) = 0\)</span> (in this example), and generally the solutions are not linear.</li>
<li>One could also include interaction terms, higher degree polynomials, etc., and thus the feature space could enlarge quickly and entail unmanageable computations.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cortes (1995)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The soft margin classifier is credit to Kristin Bennett, Vladimir Vapnik, and Corinna Cortes.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conceptual Task 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We now investigate a non-linear decision boundary.</p>
<ul>
<li>blue: <span class="math inline">\((1 + X_{1})^{2} + (2 - X_{2})^{2} &gt; 4\)</span></li>
<li>red: <span class="math inline">\((1 + X_{1})^{2} + (2 - X_{2})^{2} &lt; 4\)</span></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_kernel_trick_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="a">
<li>To what class is the observation (0, 0) classified? (−1, 1)? (2, 2)? (3, 8)?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">euclidean_distance</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "red"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">euclidean_distance</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "red"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">euclidean_distance</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "red"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">euclidean_distance</span>(<span class="dv">3</span>, <span class="dv">8</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "blue"</code></pre>
</div>
</div>
<ol start="4" type="a">
<li>While the decision boundary</li>
</ol>
<p><span class="math display">\[(1 + X_{1})^{2} + (2 - X_{2})^{2} = 4\]</span></p>
<p>is not linear in <span class="math inline">\(X_{1}\)</span> and <span class="math inline">\(X_{2}\)</span>, it is linear in terms of <span class="math inline">\(X_{1}\)</span>, <span class="math inline">\(X_{1}^{2}\)</span>, <span class="math inline">\(X_{2}\)</span>, <span class="math inline">\(X_{2}^{2}\)</span></p>
<p><span class="math display">\[\beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}X_{1}^{2} + \beta_{4}X_{2}^{2} = 0\]</span></p>
<p>with <span class="math inline">\(\beta_{0} = 1\)</span>, <span class="math inline">\(\beta_{1} = 2\)</span>, <span class="math inline">\(\beta_{2} = -4\)</span>, <span class="math inline">\(\beta_{3} = 1\)</span>, and <span class="math inline">\(\beta_{4} = 1\)</span>.</p>
</div>
</div>
</div>
</section>
</section>
<section id="the-kernel-trick" class="level1">
<h1>The Kernel Trick</h1>
<p>As presented in <em>Why Machines Learn</em> by Anil Ananthaswamy (pages 224 to 241),</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Kernel Trick
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we can find a mapping</p>
<p><span class="math display">\[x_{j} \rightarrow \phi(x_{j})\]</span></p>
<p>where <span class="math inline">\(x_{j} \in \mathbb{R}^{d}\)</span> is in a lower-dimensional space and <span class="math inline">\(\phi(x_{j}) \in \mathbb{R}^{n}\)</span> is in a higher-dimensional space (i.e.&nbsp;<span class="math inline">\(d &lt; n\)</span>) and</p>
<p><span class="math display">\[K(x_{i}, x_{j}) = \phi(x_{i}) \cdot \phi(x_{j})\]</span></p>
<p>then the <strong>kernel function</strong> allows us to compute inner products in the lower-dimensional space rather than the higher dimensional space.</p>
</div>
</div>
<section id="example-1" class="level2">
<h2 class="anchored" data-anchor-id="example-1">Example 1:</h2>
<p><span class="math display">\[a = \left[\begin{array}{c}a_{1} \\ a_{2}\end{array}\right], b = \left[\begin{array}{c}b_{1} \\ b_{2}\end{array}\right], \quad K(x,y) = (x \cdot y)^{2}, \quad \phi(x) = \left[\begin{array}{c}x_{1}^{2} \\ x_{2}^{2} \\ \sqrt{2}x_{1}x_{2}\end{array}\right]\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
3D
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[\begin{array}{rcl}
  \phi(a) \cdot \phi(b) &amp; = &amp; \left[\begin{array}{c}a_{1}^{2} \\ a_{2}^{2} \\ \sqrt{2}a_{1}a_{2}\end{array}\right] \cdot \left[\begin{array}{c}b_{1}^{2} \\ b_{2}^{2} \\ \sqrt{2}b_{1}b_{2}\end{array}\right] \\
   &amp; = &amp; a_{1}^{2}b_{1}^{2} + a_{2}^{2}b_{2}^{2} + 2a_{1}a_{2}b_{1}b_{2} \\
   \end{array}\]</span></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2D
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[\begin{array}{rcl}
  K(a,b) &amp; = &amp; (a \cdot b)^{2} \\
  ~ &amp; = &amp; \left(\left[\begin{array}{c}a_{1} \\ a_{2}\end{array}\right] \cdot \left[\begin{array}{c}b_{1} \\ b_{2}\end{array}\right]\right)^{2} \\
  ~ &amp; = &amp; (a_{1}b_{1} + a_{2}b_{2})^{2} \\
  ~ &amp; = &amp; a_{1}^{2}b_{1}^{2} + a_{2}^{2}b_{2}^{2} + 2a_{1}a_{2}b_{1}b_{2} \\
   \end{array}\]</span></p>
</div>
</div>
</div>
</section>
<section id="example-2" class="level2">
<h2 class="anchored" data-anchor-id="example-2">Example 2:</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Kernel_trick_picture.png" class="img-fluid figure-img"></p>
<figcaption>kernel trick</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://medium.com/@zxr.nju/what-is-the-kernel-trick-why-is-it-important-98a98db0961d">Grace Zhang</a></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Guyon (1980s)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The kernel trick, its development for SVMs, and synthesis is credited to Isabelle Guyon (Bell Labs)</p>
</div>
</div>
</div>
</section>
</section>
<section id="support-vector-machines" class="level1">
<h1>Support Vector Machines</h1>
<ul>
<li>The SVM is an extension of the SVC which results from using <em>kernels</em> to enlarge the feature space. A kernel is a function that quantifies the similarity of two data points.</li>
<li>Essentially, we want to enlarge the feature space to make use of a nonlinear decision boundary, while avoiding getting bogged down in unmanageable calculations.</li>
<li>The solution to the SVC problem in the SVM context involves only the <em>inner products</em> (AKA dot products) of the observations.</li>
</ul>
<p><span class="math display">\[\langle x_{i}  \; , x_{i'} \; \rangle = \sum_{j=1}^{p}x_{ij}x_{i'j}\]</span></p>
<p>In the context of SVM, the linear support vector classifier is as follows:</p>
<p><span class="math display">\[f(x) = \beta_{0} + \sum_{i=1}^{n}\alpha_{i}\langle \; x, x_i\; \rangle\]</span></p>
<ul>
<li>To estimate the <span class="math inline">\(n\)</span> <span class="math inline">\(\alpha_{i}\)</span> coefficients and <span class="math inline">\(\beta_{0}\)</span>, we only need the <span class="math inline">\(\binom{n}{2}\)</span> inner products between all pairs of training observations.</li>
<li>Note that in the equation above, in order to compute <span class="math inline">\(f(x)\)</span> for the new point <span class="math inline">\(x\)</span>, we need the inner product between the new point and all the training observations. However, <span class="math inline">\(\alpha_{i} = 0\)</span> for all points that are not on or within the margin (i.e., points that are not support vectors). So we can rewrite the equation as follows, where <span class="math inline">\(S\)</span> is the set of support point indices:</li>
</ul>
<p><span class="math display">\[f(x) = \beta_{0} + \sum_{i \in S}\alpha_{i}\langle \; x, x_{i} \; \rangle\]</span></p>
<ul>
<li>Replace every inner product with <span class="math inline">\(K(x_{i}, x_{i'})\)</span>, where <span class="math inline">\(K\)</span> is a kernel function.</li>
<li><span class="math inline">\(K(x_{i}, x_{i'}) = \sum_{j=1}^{p}x_{ij}x_{i'j}\)</span> is the SVC and is known as a linear kernel since it is linear in the features.</li>
<li>One could also have kernel functions of the following form, where <span class="math inline">\(d\)</span> is a positive integer:</li>
</ul>
<p><span class="math display">\[K(x_{i}, x_{i'}) = \left(1 + \sum_{j=1}^{p}x_{ij}x_{i'j}\right)^d\]</span></p>
<ul>
<li>This will lead to a much more flexible decision boundary, and is basically fitting an SVC in a higher-dimensional space involving polynomials of degree <span class="math inline">\(d\)</span>, instead of the original feature space.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Poggio (1975)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The polynomial kernels for SVMs are credited to Tomaso Poggio (MIT computational neuroscientist)</p>
</div>
</div>
</div>
<ul>
<li>When an SVC is combined with a nonlinear kernel as above, the result is a <em>support vector machine</em>.</li>
</ul>
<p><span class="math display">\[f(x) =  \beta_{0} + \sum_{i \in S}\alpha_{i}K(x, x_{i})\]</span></p>
<section id="radial-kernels" class="level2">
<h2 class="anchored" data-anchor-id="radial-kernels">Radial Kernels</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/gaussian.png" class="img-fluid figure-img"></p>
<figcaption>AKA: Gaussians, image credit: Manin Bocss</figcaption>
</figure>
</div>
<ul>
<li>There are other options besides polynomial kernel functions, and a popular one is a <em>radial kernel</em>.</li>
</ul>
<p><span class="math display">\[K(x, x_{i}) = \text{exp}\left(-\gamma\sum_{j=1}^p(x_{ij} - x_{i'j})^2\right), \quad \gamma &gt; 0\]</span></p>
<ul>
<li>For a given test observations <span class="math inline">\(x^*\)</span>, if it is far from <span class="math inline">\(x_{i}\)</span>, then <span class="math inline">\(K(x^*, x_{i})\)</span> will be small given the negative <span class="math inline">\(\gamma\)</span> and large <span class="math inline">\(\sum_{j=1}^p(x^*_{j} - x_{ij})^2)\)</span>.</li>
<li>Thus, <span class="math inline">\(x_{i}\)</span> will play little role in <span class="math inline">\(f(x^*)\)</span>.</li>
<li>The predicted class for <span class="math inline">\(x^*\)</span> is based on the sign of <span class="math inline">\(f(x^*)\)</span>, so training observations far from a given test point play little part in determining the label for a test observation.</li>
<li>The radial kernel therefore exhibits local behavior with respect to other observations.</li>
</ul>
</section>
<section id="svm-with-radial-kernels" class="level2">
<h2 class="anchored" data-anchor-id="svm-with-radial-kernels">SVM with Radial Kernels</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fig9_9.png" class="img-fluid figure-img"></p>
<figcaption>image credit: Manin Bocss</figcaption>
</figure>
</div>
<ul>
<li>The advantage of using a kernel rather than simply enlarging feature space is computational, since it is only necessary to compute <span class="math inline">\(\binom{n}{2}\)</span> kernel functions.</li>
<li>For radial kernels, the feature space is implicit and infinite dimensional, so we could not do the computations in such a space anyways.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DCP3
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
</section>
<section id="more-than-two-classes" class="level1">
<h1>More than Two Classes</h1>
<ul>
<li>The concept of separating hyperplanes does not extend naturally to more than two classes, but there are some ways around this.</li>
<li>A <em>one-versus-one</em> approach constructs <span class="math inline">\(K \choose 2\)</span> SVMs, where <span class="math inline">\(K\)</span> is the number of classes. An observation is classified to each of the <span class="math inline">\(K \choose 2\)</span> classes, and the number of times it appears in each class is counted.</li>
<li>The <span class="math inline">\(k^\text{th}\)</span> class might be coded as +1 versus the <span class="math inline">\((k')^\text{th}\)</span> class is coded as -1.</li>
<li>The data point is classified to the class for which it was most often assigned in the pairwise classifications.</li>
<li>Another option is <em>one-versus-all</em> classification. This can be useful when there are a lot of classes.</li>
<li><span class="math inline">\(K\)</span> SVMs are fitted, and one of the K classes to the remaining <span class="math inline">\(K-1\)</span> classes.</li>
<li><span class="math inline">\(\beta_{0k}...\beta_{pk}\)</span> denotes the parameters that results from constructing an SVM comparing the <span class="math inline">\(k\)</span>th class (coded as +1) to the other classes (-1).</li>
<li>Assign test observation <span class="math inline">\(x^*\)</span> to the class <span class="math inline">\(k\)</span> for which <span class="math inline">\(\beta_{0k} + ... + \beta_{pk}x^*_{p}\)</span> is largest.</li>
</ul>
</section>
<section id="svm-legacy" class="level1">
<h1>SVM Legacy</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/BBVA_award_2020.png" class="img-fluid figure-img"></p>
<figcaption>SVM inventors</figcaption>
</figure>
</div>
<p>“The BBVA Foundation has awarded Isabelle Guyon, Bernhard Schölkopf and Vladimir Vapnik with the <a href="https://www.bbva.com/en/the-frontiers-of-knowledge-awards-recognize-guyon-scholkopt-and-vapnik-for-teaching-machines-how-to-classify-data/">Frontiers of Knowledge Award in the Information and Communication Technologies category</a>, for helping advance the field of artificial intelligence with their seminal contributions to machine learning.”</p>
<ul>
<li><p>Schölkopf coined the phrase “support vector machines” to distance the idea away from neural networks</p>
<ul>
<li>neural networks were distant in the “AI Winter” (little research gains) from 1981 to 2012</li>
<li>“machine learning” becomes very popular</li>
</ul></li>
</ul>
</section>
<section id="quo-vadimus" class="level1">
<h1>Quo Vadimus?</h1>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><p>due this Friday:</p>
<ul>
<li>Precept 5</li>
<li>CuriosityMid (survey)</li>
</ul></li>
</ul>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/python_import_joke.png" class="img-fluid figure-img"></p>
<figcaption>sarcasm</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="footnotes" class="level1">
<h1>Footnotes</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
(optional) Additional Resources
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://medium.com/towards-data-science/support-vector-machines-explained-with-python-examples-cb65e8172c85">SVM in Python</a> by Carolina Bento</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Matrix products: default
  LAPACK version 3.12.1

locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] lubridate_1.9.4   forcats_1.0.0     stringr_1.5.1     dplyr_1.1.4      
 [5] purrr_1.1.0       readr_2.1.5       tidyr_1.3.1       tibble_3.3.0     
 [9] ggplot2_4.0.0     tidyverse_2.0.0   DiagrammeR_1.0.11

loaded via a namespace (and not attached):
 [1] gtable_0.3.6       jsonlite_2.0.0     compiler_4.5.1     tidyselect_1.2.1  
 [5] scales_1.4.0       yaml_2.3.10        fastmap_1.2.0      R6_2.6.1          
 [9] labeling_0.4.3     generics_0.1.4     knitr_1.50         htmlwidgets_1.6.4 
[13] visNetwork_2.1.4   pillar_1.11.0      RColorBrewer_1.1-3 tzdb_0.5.0        
[17] rlang_1.1.6        stringi_1.8.7      xfun_0.52          S7_0.2.0          
[21] timechange_0.3.0   cli_3.6.5          withr_3.0.2        magrittr_2.0.3    
[25] digest_0.6.37      grid_4.5.1         rstudioapi_0.17.1  hms_1.1.3         
[29] lifecycle_1.0.4    vctrs_0.6.5        evaluate_1.0.4     glue_1.8.0        
[33] farver_2.1.2       rmarkdown_2.29     tools_4.5.1        pkgconfig_2.0.3   
[37] htmltools_0.5.8.1 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column" style="width:45%;">

</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">

</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"></ul>
<div class="tab-content">

</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>