<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Derek Sollberger">
<meta name="dcterms.date" content="2025-10-29">

<title>15: Image Processing – SML 301 Slides</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2f6844b3748638c5738d4cf93630e566.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SML 301 Slides</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Lecture Sessions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#session-15-image-processing" id="toc-session-15-image-processing" class="nav-link active" data-scroll-target="#session-15-image-processing">Session 15: Image Processing</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives:</a></li>
  </ul></li>
  <li><a href="#preprocessing-min-max-normalization" id="toc-preprocessing-min-max-normalization" class="nav-link" data-scroll-target="#preprocessing-min-max-normalization">Preprocessing: Min-Max Normalization</a>
  <ul class="collapse">
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">motivation</a></li>
  </ul></li>
  <li><a href="#forward-propogation" id="toc-forward-propogation" class="nav-link" data-scroll-target="#forward-propogation">Forward Propogation</a>
  <ul class="collapse">
  <li><a href="#trained-model" id="toc-trained-model" class="nav-link" data-scroll-target="#trained-model">Trained Model</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  <li><a href="#obvious-example" id="toc-obvious-example" class="nav-link" data-scroll-target="#obvious-example">Obvious Example</a></li>
  <li><a href="#tough-classification" id="toc-tough-classification" class="nav-link" data-scroll-target="#tough-classification">Tough Classification</a></li>
  </ul></li>
  <li><a href="#activation-functions" id="toc-activation-functions" class="nav-link" data-scroll-target="#activation-functions">Activation Functions</a></li>
  <li><a href="#bias" id="toc-bias" class="nav-link" data-scroll-target="#bias">Bias</a></li>
  <li><a href="#post-processing-softmax" id="toc-post-processing-softmax" class="nav-link" data-scroll-target="#post-processing-softmax">Post-Processing: Softmax</a>
  <ul class="collapse">
  <li><a href="#obvious-example-1" id="toc-obvious-example-1" class="nav-link" data-scroll-target="#obvious-example-1">Obvious Example</a></li>
  <li><a href="#tough-classification-1" id="toc-tough-classification-1" class="nav-link" data-scroll-target="#tough-classification-1">Tough Classification</a></li>
  <li><a href="#derivative" id="toc-derivative" class="nav-link" data-scroll-target="#derivative">Derivative</a></li>
  </ul></li>
  <li><a href="#loss" id="toc-loss" class="nav-link" data-scroll-target="#loss">Loss</a></li>
  <li><a href="#back-propogation" id="toc-back-propogation" class="nav-link" data-scroll-target="#back-propogation">Back Propogation</a>
  <ul class="collapse">
  <li><a href="#initialization" id="toc-initialization" class="nav-link" data-scroll-target="#initialization">Initialization</a></li>
  <li><a href="#partial-derivatives" id="toc-partial-derivatives" class="nav-link" data-scroll-target="#partial-derivatives">Partial Derivatives</a></li>
  <li><a href="#chain-rule" id="toc-chain-rule" class="nav-link" data-scroll-target="#chain-rule">Chain Rule</a></li>
  <li><a href="#update" id="toc-update" class="nav-link" data-scroll-target="#update">Update</a></li>
  <li><a href="#feed-foward" id="toc-feed-foward" class="nav-link" data-scroll-target="#feed-foward">Feed Foward</a></li>
  </ul></li>
  <li><a href="#python-code" id="toc-python-code" class="nav-link" data-scroll-target="#python-code">Python Code</a>
  <ul class="collapse">
  <li><a href="#tensors" id="toc-tensors" class="nav-link" data-scroll-target="#tensors">Tensors</a>
  <ul class="collapse">
  <li><a href="#what-are-tensors" id="toc-what-are-tensors" class="nav-link" data-scroll-target="#what-are-tensors">What are tensors?</a></li>
  <li><a href="#why-do-we-use-tensors" id="toc-why-do-we-use-tensors" class="nav-link" data-scroll-target="#why-do-we-use-tensors">Why do we use tensors?</a></li>
  </ul></li>
  <li><a href="#object-oriented-programming" id="toc-object-oriented-programming" class="nav-link" data-scroll-target="#object-oriented-programming">Object-Oriented Programming</a></li>
  </ul></li>
  <li><a href="#image-processing" id="toc-image-processing" class="nav-link" data-scroll-target="#image-processing">Image Processing</a></li>
  <li><a href="#saliency-maps" id="toc-saliency-maps" class="nav-link" data-scroll-target="#saliency-maps">Saliency Maps</a></li>
  <li><a href="#ethics-segment-voices" id="toc-ethics-segment-voices" class="nav-link" data-scroll-target="#ethics-segment-voices">Ethics Segment: Voices</a></li>
  <li><a href="#imagenet" id="toc-imagenet" class="nav-link" data-scroll-target="#imagenet">ImageNet</a>
  <ul class="collapse">
  <li><a href="#image-augmentation" id="toc-image-augmentation" class="nav-link" data-scroll-target="#image-augmentation">Image Augmentation</a></li>
  </ul></li>
  <li><a href="#quo-vadimus" id="toc-quo-vadimus" class="nav-link" data-scroll-target="#quo-vadimus">Quo Vadimus?</a></li>
  <li><a href="#footnotes" id="toc-footnotes" class="nav-link" data-scroll-target="#footnotes">Footnotes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">15: Image Processing</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Derek Sollberger </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 29, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="session-15-image-processing" class="level1">
<h1>Session 15: Image Processing</h1>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning objectives:</h2>
<div class="columns">
<div class="column" style="width:45%;">
<ul>
<li>Review calculations in neural networks</li>
<li>Explore image processing</li>
<li>Introduce image augmentation</li>
</ul>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="princeton_tiger_nobg.png" class="img-fluid figure-img"></p>
<figcaption>image processing</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessing-min-max-normalization" class="level1">
<h1>Preprocessing: Min-Max Normalization</h1>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">motivation</h2>
<p>For 32-bit float number representation</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Float_example.svg.png" class="img-fluid figure-img"></p>
<figcaption>floating-point representation</figcaption>
</figure>
</div>
<ul>
<li>range: <span class="math inline">\((1.1755 \times 10^{-38}, 1.7014 \times 10^{38})\)</span></li>
</ul>
<p>Anticipating neural networks and performing many calculations, we want to avoid overflow or underflow errors.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preprocessing Numbers
</div>
</div>
<div class="callout-body-container callout-body">
<p>To make the numerical inputs and outputs more manageable, we will employ</p>
<ul>
<li>min-max normalization</li>
<li>softmax</li>
</ul>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">scene</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">formula</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">rescaled</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">bases</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_image_processing_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>We want numerical inputs to be between 0 and 1, so we can employ <strong>min-max normalization</strong>:</p>
<p><span class="math display">\[\text{scaled}(x) = \frac{x - \text{min}}{\text{max} - \text{min}}\]</span></p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_image_processing_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_image_processing_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="forward-propogation" class="level1">
<h1>Forward Propogation</h1>
<section id="trained-model" class="level2">
<h2 class="anchored" data-anchor-id="trained-model">Trained Model</h2>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[flipper length]
input_2[body mass]
output_1[Adelie]
output_2[Chinstrap]
output_3[Gentoo]

input_1 -- -1.16A + 0.38 --&gt; output_1
input_1 -- 0.24A - 0.38 --&gt; output_2
input_1 -- 1.77A + 0.16 --&gt; output_3
input_2 -- -0.05B + 0.38 --&gt; output_1
input_2 -- 0.18B - 0.38 --&gt; output_2
input_2 -- 1.07B + 0.16 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<ul>
<li><p>input layer size: 2</p></li>
<li><p>output layer size: 3</p></li>
<li><p><strong>fully-connected network</strong>: every output is connected to every input by an edge</p>
<ul>
<li>here: no hidden layer</li>
<li>later: LSTM, transformers, encoder-decorders</li>
</ul></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Where did the coefficients come from?
</div>
</div>
<div class="callout-body-container callout-body">
<p>We will train the neural network and compute the weights and bias values soon! For now, let us see how the forward calculations work in this trained model.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
These will be poor results
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The examples in today’s session will have poor results (i.e.&nbsp;accuracy values close to 50 percent). This is because of</p>
<ul>
<li>small data sets</li>
<li>models run for a limited number of epochs (iterations)</li>
</ul>
</div>
</div>
</div>
</section>
<section id="parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters">Parameters</h2>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[flipper length]
input_2[body mass]
output_1[Adelie]
output_2[Chinstrap]
output_3[Gentoo]

input_1 -- -1.16A + 0.38 --&gt; output_1
input_1 -- 0.24A - 0.38 --&gt; output_2
input_1 -- 1.77A + 0.16 --&gt; output_3
input_2 -- -0.05B + 0.38 --&gt; output_1
input_2 -- 0.18B - 0.38 --&gt; output_2
input_2 -- 1.07B + 0.16 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p>This model has 9 parameters:</p>
<ul>
<li>weights</li>
</ul>
<p><span class="math display">\[\begin{array}{rcr}
  w_{1,1} &amp; \approx &amp; -1.16 \\
  w_{1,2} &amp; \approx &amp; 0.24 \\
  w_{1,3} &amp; \approx &amp; 1.77 \\
  w_{2,1} &amp; \approx &amp; -0.05 \\
  w_{2,2} &amp; \approx &amp; 0.18 \\
  w_{2,3} &amp; \approx &amp; 1.07 \\
\end{array}\]</span></p>
<ul>
<li>bias</li>
</ul>
<p><span class="math display">\[\begin{array}{rcr}
  b_{1} &amp; \approx &amp; 0.76 \\
  b_{2} &amp; \approx &amp; -0.76 \\
  b_{3} &amp; \approx &amp; 0.32 \\
\end{array}\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Split Bias?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Editor’s note: for the sake of simplifying the diagram, the bias values were split in half (two input variables). In practice, the bias values are added after the weight multiplications. This will be more apparent in the matrix computations later. Furthermore, the values going into the output nodes are also added together.</p>
</div>
</div>
</section>
<section id="obvious-example" class="level2">
<h2 class="anchored" data-anchor-id="obvious-example">Obvious Example</h2>
<p>What will our model predict for a Gentoo penguin whose measurements (after min-max normalization) include a flipper length of 0.75 and a body mass of 0.75?</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[0.75]
input_2[0.75]
output_1[-0.1475]
output_2[-0.4450]
output_3[2.4500]

input_1 -- -1.16*0.75 + 0.38 --&gt; output_1
input_1 -- 0.24*0.75 - 0.38 --&gt; output_2
input_1 -- 1.77*0.75 + 0.16 --&gt; output_3
input_2 -- -0.05*0.75 + 0.38 --&gt; output_1
input_2 -- 0.18*0.75 - 0.38 --&gt; output_2
input_2 -- 1.07*0.75 + 0.16 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p>Since the output value is the largest for the Gentoo label, we predict that such a penguin is of the Gentoo species.</p>
</div>
</div>
</section>
<section id="tough-classification" class="level2">
<h2 class="anchored" data-anchor-id="tough-classification">Tough Classification</h2>
<p>What will our model predict for a penguin whose measurements (after min-max normalization) include a flipper length of 0.301 and a body mass of 0.301?</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[0.301]
input_2[0.301]
output_1[0.37579]
output_2[-0.63358]
output_3[1.17484]

input_1 -- -1.16*0.301 + 0.38 --&gt; output_1
input_1 -- 0.24*0.301 - 0.38 --&gt; output_2
input_1 -- 1.77*0.301 + 0.16 --&gt; output_3
input_2 -- -0.05*0.301 + 0.38 --&gt; output_1
input_2 -- 0.18*0.301 - 0.38 --&gt; output_2
input_2 -- 1.07*0.301 + 0.16 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p>Since the output value is the largest for the Gentoo label, we predict that such a penguin is of the Gentoo species.</p>
<p>However, the output values should have favored the Adelie and Chinstrap penguins here.</p>
</div>
</div>
</section>
</section>
<section id="activation-functions" class="level1">
<h1>Activation Functions</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">motivation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">sigmoid</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">tanh</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">ReLU</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<ul>
<li><p>Can you name a function whose domain is all real numbers but its range is restricted to <span class="math inline">\((0,1)\)</span>?</p></li>
<li><p>Can you name a function whose domain is all real numbers but its range is restricted to <span class="math inline">\((-1,1)\)</span>?</p></li>
</ul>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="activation_sigmoid.png" class="img-fluid figure-img"></p>
<figcaption>sigmoid function</figcaption>
</figure>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:60%;">
<p><span class="math display">\[f(x) = \frac{1}{1 + e^{-x}}\]</span></p>
<ul>
<li>domain: <span class="math inline">\((-\infty, \infty)\)</span></li>
<li>range: <span class="math inline">\((0,1)\)</span></li>
</ul>
<p>derivative:</p>
<p><span class="math display">\[f'(x) = f(x)[1 - f(x)]\]</span></p>
<ul>
<li>2 function calls</li>
<li>one multiplication, one subtraction</li>
</ul>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="activation_tanh.png" class="img-fluid figure-img"></p>
<figcaption>hyperbolic tangent</figcaption>
</figure>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:60%;">
<p><span class="math display">\[f(x) = \tanh(x) = \frac{e^{x} - e^{-x}}{e^{x} + e^{-x}}\]</span></p>
<ul>
<li>domain: <span class="math inline">\((-\infty, \infty)\)</span></li>
<li>range: <span class="math inline">\((-1,1)\)</span></li>
</ul>
<p>derivative:</p>
<p><span class="math display">\[f'(x) = 1 - \tanh^{2}(x)\]</span></p>
<ul>
<li>2 function calls</li>
<li>one multiplication, one subtraction</li>
</ul>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="activation_ReLU.png" class="img-fluid figure-img"></p>
<figcaption>rectified linear unit</figcaption>
</figure>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:60%;">
<p><span class="math display">\[f(x) = \begin{cases}x, &amp; x \geq 0 \\ 0, &amp; x &lt; 0\end{cases}\]</span></p>
<ul>
<li>domain: <span class="math inline">\((-\infty, \infty)\)</span></li>
<li>range: <span class="math inline">\((0,\infty)\)</span></li>
</ul>
<p>derivative:</p>
<p><span class="math display">\[f'(x) = \begin{cases}1, &amp; x &gt; 0 \\ 0, &amp; x &lt; 0\end{cases}\]</span></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="bias" class="level1">
<h1>Bias</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">scene</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">bias</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">ReLU</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">float</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Suppose that the high temperature observations at Princeton (in degrees Fahrenheit) are usually between 16 and 90 degrees and that, relatively speaking, local people consider it to be a “warm day” if the temperature is at least 60 degrees (“cold day” otherwise):</p>
<p><span class="math display">\[f(H) = \begin{cases}
  \text{warm day}, &amp; H \geq 60 \\
  \text{cold day}, &amp; H &lt; 60 \\
\end{cases}\]</span></p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>We can shift the values by a <strong>bias</strong>. For example, if we use a bias value of <span class="math inline">\(b = 60\)</span>, then</p>
<p><span class="math display">\[f(H-60) = \begin{cases}
  \text{warm day}, &amp; H-60 \geq 0 \\
  \text{cold day}, &amp; H-60 &lt; 0 \\
\end{cases}\]</span></p>
<p>puts the decision boundary at a value of zero in the new units.</p>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="activation_ReLU.png" class="img-fluid figure-img"></p>
<figcaption>rectified linear unit</figcaption>
</figure>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:60%;">
<p><span class="math display">\[f(x) = \begin{cases}x, &amp; x \geq 0 \\ 0, &amp; x &lt; 0\end{cases}\]</span></p>
<ul>
<li>domain: <span class="math inline">\((-\infty, \infty)\)</span></li>
<li>range: <span class="math inline">\((0,\infty)\)</span></li>
</ul>
<p>derivative:</p>
<p><span class="math display">\[f'(x) = \begin{cases}1, &amp; x &gt; 0 \\ 0, &amp; x &lt; 0\end{cases}\]</span></p>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Float_example.svg.png" class="img-fluid figure-img"></p>
<figcaption>floating-point representation</figcaption>
</figure>
</div>
<p>A TPU (tensor processing unit) would only have to check one bit!</p>
</div>
</div>
</div>
</section>
<section id="post-processing-softmax" class="level1">
<h1>Post-Processing: Softmax</h1>
<p>Another way to normalize a vector of numerical observations is to employ the <strong>softmax</strong></p>
<p><span class="math display">\[\text{Softmax}(\vec{x})_{i} = \frac{e^{x_{i}}}{\sum_{i=1}^{n}e^{x_{i}}}\]</span></p>
<section id="obvious-example-1" class="level2">
<h2 class="anchored" data-anchor-id="obvious-example-1">Obvious Example</h2>
<p>What will our model predict for a penguin whose measurements (after min-max normalization) include a flipper length of 0.75 and a body mass of 0.75?</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[0.75]
input_2[0.75]
output_1[-0.1475]
output_2[-0.4450]
output_3[2.4500]

input_1 -- -1.16*0.75 + 0.38 --&gt; output_1
input_1 -- 0.24*0.75 - 0.38 --&gt; output_2
input_1 -- 1.77*0.75 + 0.16 --&gt; output_3
input_2 -- -0.05*0.75 + 0.38 --&gt; output_1
input_2 -- 0.18*0.75 - 0.38 --&gt; output_2
input_2 -- 1.07*0.75 + 0.16 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p><span class="math inline">\(\frac{e^{-0.1475}}{e^{-0.1475} + e^{-0.4450} + e^{2.4500}} \approx 0.0659\)</span> <span class="math inline">\(\frac{e^{-0.4450}}{e^{-0.1475} + e^{-0.4450} + e^{2.4500}} \approx 0.0489\)</span> <span class="math inline">\(\frac{e^{2.4500}}{e^{-0.1475} + e^{-0.4450} + e^{2.4500}} \approx 0.8851\)</span></p>
</div>
</div>
</section>
<section id="tough-classification-1" class="level2">
<h2 class="anchored" data-anchor-id="tough-classification-1">Tough Classification</h2>
<p>What will our model predict for a penguin whose measurements (after min-max normalization) include a flipper length of 0.301 and a body mass of 0.301?</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[0.301]
input_2[0.301]
output_1[0.37579]
output_2[-0.63358]
output_3[1.17484]

input_1 -- -1.16*0.301 + 0.38 --&gt; output_1
input_1 -- 0.24*0.301 - 0.38 --&gt; output_2
input_1 -- 1.77*0.301 + 0.16 --&gt; output_3
input_2 -- -0.05*0.301 + 0.38 --&gt; output_1
input_2 -- 0.18*0.301 - 0.38 --&gt; output_2
input_2 -- 1.07*0.301 + 0.16 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p><span class="math display">\[\begin{array}{c|c|c}
  \text{signal} &amp; \text{exponent} &amp; \text{softmax} \\
  \hline
  0.3758 &amp; e^{0.3758} &amp; 0.2787 \\
  -0.6336 &amp; e^{-0.6336} &amp; 0.1016 \\
  1.1748 &amp; e^{1.1748} &amp; 0.6197 \\
\end{array}\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Does the softmax output create a probability distribution?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It’s debatable.</p>
<p>While the values from a softmax computation are positive sum up to one (up to a rounding error), it is debatable whether or not the softmax result is a probability distribution.</p>
<ul>
<li>Nodes earlier in the network (especially in neural networks) can be permuted. While we might end up with the same distribution, the underlying weights might be quite different.</li>
<li>What do these proportions represent? Later, if we use this softmax output as inputs for another <em>module</em>, then we can say something like “The output signal is about 28 percent Adelie, 10 percent Chinstrap, and 62 percent Gentoo.”</li>
<li>Are these proportions <em>unbiased estimators</em> of population proportions?</li>
</ul>
</div>
</div>
</div>
</section>
<section id="derivative" class="level2">
<h2 class="anchored" data-anchor-id="derivative">Derivative</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>Softmax function <span class="math display">\[\sigma({\vec{x}})_{i} = \frac{e^{x_{i}}}{\sum_{i=1}^{n}e^{x_{i}}}\]</span></p>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p>Derivative <span class="math display">\[\frac{\partial \sigma_{k}}{\partial x_{i}} = \sigma_{k}(\delta_{ik} - \sigma_{i})\]</span> where <span class="math display">\[\delta_{ik} = \begin{cases} 1, &amp; i = k \\ 0, &amp; i \neq k \\ \end{cases}\]</span></p>
</div>
</div>
</section>
</section>
<section id="loss" class="level1">
<h1>Loss</h1>
<p>Toward training and backprogation, for a classification task, we could use the <strong>sum-of-squared residuals</strong> (SSR) to calculate the <strong>loss</strong>.</p>
<p><span class="math display">\[\text{SSR} = \sum_{i=1}^{n}(\text{observed}_{i} - \text{predicted}_{i})^{2}\]</span></p>
</section>
<section id="back-propogation" class="level1">
<h1>Back Propogation</h1>
<p>Here, we will see how backpropogation works to update <em>one weight</em> in our network.</p>
<section id="initialization" class="level2">
<h2 class="anchored" data-anchor-id="initialization">Initialization</h2>
<p>Consider a fully-connected network (FCN) where all of the weights have been initialized to the same uniform value of 0.2 and each bias has been initialized to be zero. What will our model predict for a Gentoo penguin whose measurements (after min-max normalization) include a flipper length of 0.75 and a body mass of 0.75?</p>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[0.75]
input_2[0.75]
output_1[0.3]
output_2[0.3]
output_3[0.3]

input_1 -- 0.2*0.75 + 0 --&gt; output_1
input_1 -- 0.2*0.75 + 0 --&gt; output_2
input_1 -- 0.2*0.75 + 0 --&gt; output_3
input_2 -- 0.2*0.75 + 0 --&gt; output_1
input_2 -- 0.2*0.75 + 0 --&gt; output_2
input_2 -- 0.2*0.75 + 0 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:50%;">
<p><span class="math display">\[\begin{array}{c|c|c}
  \text{predicted} &amp; \text{observed} &amp; \text{residual} \\
  \hline
  0.3333 &amp; 0 &amp; 0.3333 \\
  0.3333 &amp; 0 &amp; 0.3333 \\
  0.3333 &amp; 1 &amp; -0.6667 \\
\end{array}\]</span></p>
<p>Note: this initialization assumes that each penguin species is equally likely.</p>
</div>
</div>
</section>
<section id="partial-derivatives" class="level2">
<h2 class="anchored" data-anchor-id="partial-derivatives">Partial Derivatives</h2>
<p>Here, we will update weight <span class="math inline">\(w_{2,3} = 0.2\)</span>. The composition of the linear transformation, softmax, and SSR loss yields the following partial derivatives:</p>
<ul>
<li>linear transformation:</li>
</ul>
<p><span class="math display">\[\frac{\partial L}{\partial w_{2,3}} = x_{2}\]</span></p>
<ul>
<li>softmax:</li>
</ul>
<p><span class="math display">\[\frac{\partial \sigma_{3}}{\partial L_{3}} = (\sigma_{3})(1 - \sigma_{3})\]</span></p>
<ul>
<li>loss:</li>
</ul>
<p><span class="math display">\[\frac{\partial\text{SSR}}{\partial{\sigma_{3}}} = -2(\text{observed}_{3} - \text{predicted}_{3})\]</span></p>
</section>
<section id="chain-rule" class="level2">
<h2 class="anchored" data-anchor-id="chain-rule">Chain Rule</h2>
<p>Putting it all together, we can now compute the overall derviative through the chain rule:</p>
<p><span class="math display">\[\begin{array}{rcl}
\frac{\partial\text{SSR}}{\partial w_{2,3}} &amp; = &amp; \frac{\partial\text{SSR}}{\partial{\sigma_{3}}} \cdot \frac{\partial \sigma_{3}}{\partial L_{3}} \cdot \frac{\partial L}{\partial w_{2,3}} \\
~ &amp; = &amp; -2(\text{observed}_{3} - \text{predicted}_{3}) \cdot (\sigma_{3})(1 - \sigma_{3}) \cdot x_{2} \\
~ &amp; = &amp; -2(1 - 0.3333) \cdot (0.3)(1 - 0.3) \cdot (0.75) \\
~ &amp; \approx &amp; -0.2100 \\
\end{array}\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why do we use the softmax?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One question that may appear here is, “Why do we use min-max normalization for the input layer but then use a softmax for the output layer?”</p>
<ul>
<li><p>min-max normalization</p>
<ul>
<li>pro: easier to calculate (more easily vectorized)</li>
<li>con: the derivative is simply just the number one (same if we used an argmax), so applying this normalization does not create information for us for back propogation</li>
</ul></li>
<li><p>softmax</p>
<ul>
<li>pro: derivative values between 0 and 1</li>
<li>con: more intense calculation (especially for long vectors)</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why don’t we use the SSR?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The derivative values from the SSR are relatively small, and hence the learning is slow.</p>
</div>
</div>
</div>
</section>
<section id="update" class="level2">
<h2 class="anchored" data-anchor-id="update">Update</h2>
<p>Finally, we can apply a step size</p>
<p><span class="math display">\[\text{step size} = \text{derivative} \cdot \text{learning rate}\]</span> If we had a learning rate of 0.1 (i.e.&nbsp;as a hyperparameter), then our step size here is</p>
<p><span class="math display">\[\text{step size} = (-0.2100)(0.1) = -0.0210\]</span> Our new weight is</p>
<p><span class="math display">\[\begin{array}{rcl}
  \text{new weight} &amp; = &amp; \text{old weight} - \text{step size} \\
  ~ &amp; = &amp; 0.2 - (-0.0210) \\
  ~ &amp; = &amp; 0.2210 \\
\end{array}\]</span></p>
</section>
<section id="feed-foward" class="level2">
<h2 class="anchored" data-anchor-id="feed-foward">Feed Foward</h2>
<p>Applying this new weight, our network now looks like this</p>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

input_1[0.75]
input_2[0.75]
output_1[0.3000]
output_2[0.3000]
output_3[0.3158]

input_1 -- 0.2*0.75 + 0 --&gt; output_1
input_1 -- 0.2*0.75 + 0 --&gt; output_2
input_1 -- 0.2*0.75 + 0 --&gt; output_3
input_2 -- 0.2*0.75 + 0 --&gt; output_1
input_2 -- 0.2*0.75 + 0 --&gt; output_2
input_2 -- 0.2210*0.75 + 0 --&gt; output_3
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:50%;">
<p><span class="math display">\[\begin{array}{c|c|c}
  \text{predicted} &amp; \text{observed} &amp; \text{residual} \\
  \hline
  0.3316 &amp; 0 &amp; 0.3316 \\
  0.3316 &amp; 0 &amp; 0.3316 \\
  0.3366 &amp; 1 &amp; -0.6637 \\
\end{array}\]</span></p>
<p>Now:</p>
<ul>
<li>the prediction moved correctly toward “Gentoo”!</li>
<li>the residuals decreased!</li>
</ul>
</div>
</div>
</section>
</section>
<section id="python-code" class="level1">
<h1>Python Code</h1>
<section id="tensors" class="level2">
<h2 class="anchored" data-anchor-id="tensors">Tensors</h2>
<p>We will use tensors in Pytorch Lightning</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tensor_picture.png" class="img-fluid figure-img"></p>
<figcaption>3D tensor</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://news.mit.edu/2017/faster-big-data-analysis-tensor-algebra-1031">MIT</a></li>
</ul>
<section id="what-are-tensors" class="level3">
<h3 class="anchored" data-anchor-id="what-are-tensors">What are tensors?</h3>
<p>At first, <strong>tensors</strong> (for machine learning) are multidimensional arrays.</p>
<ul>
<li>a value is a 0D tensor</li>
<li>an array is a 1D tensor</li>
<li>a matrix is a 2D tensor</li>
</ul>
</section>
<section id="why-do-we-use-tensors" class="level3">
<h3 class="anchored" data-anchor-id="why-do-we-use-tensors">Why do we use tensors?</h3>
<ul>
<li>accelerated computations via graphical processing units (GPUs)</li>
<li>automatic differentiation</li>
<li>helps with parallelizable processes</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="parallel_process.png" class="img-fluid figure-img"></p>
<figcaption>parallel processes</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://medium.datadriveninvestor.com/python-multiprocessing-pool-vs-process-comparative-analysis-6c03c5b54eec">Faisal Shahbaz</a></li>
</ul>
</section>
</section>
<section id="object-oriented-programming" class="level2">
<h2 class="anchored" data-anchor-id="object-oriented-programming">Object-Oriented Programming</h2>
<p>Framework choice:</p>
<ul>
<li>Keras</li>
<li>PyTorch</li>
<li>Scikit Learn</li>
<li>TensorFlow</li>
</ul>
<p>Why Pytorch?</p>
<ul>
<li>recency bias (Derek studied these concepts with PyTorch)</li>
<li><strong>object-oriented programming</strong></li>
</ul>
<p>Why Object-Oriented Programming?</p>
<p>Later concepts are probably better understood as <em>modular</em> steps in a workflow, which lend themselves to object-oriented programming (OOP)</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Example 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Example 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Class Definition</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>For the penguins examples, we needed a fully-connected network whose input layer size was 2 and whose output layer size was 3</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FCN_2_3.png" class="img-fluid figure-img"></p>
<figcaption>example 1</figcaption>
</figure>
</div>
<ul>
<li>Python code: <code>model = FCN(2,3)</code></li>
</ul>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>For the next example, we need a fully-connected network whose input layer size is 4 and whose output layer size is 2</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FCN_4_2.png" class="img-fluid figure-img"></p>
<figcaption>example 2</figcaption>
</figure>
</div>
<ul>
<li>Python code: <code>model = FCN(4,2)</code></li>
</ul>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FCN(pl.LightningModule):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fully-Connected Network</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assumes no hidden layer (i.e. going directly into activation functions)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_layer_size, output_layer_size):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_layer_size <span class="op">=</span> input_layer_size </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_layer_size <span class="op">=</span> output_layer_size </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc1 <span class="op">=</span> nn.Linear(input_layer_size, output_layer_size)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_step_outputs <span class="op">=</span> []</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> F.relu(<span class="va">self</span>.fc1(x))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> training_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> batch</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>(x)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> F.cross_entropy(output, y)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">'loss'</span>:loss}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> batch</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> <span class="va">self</span>(x)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> F.cross_entropy(output, y)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_step_outputs.append(loss)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">'loss'</span>:loss}</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> on_test_epoch_end(<span class="va">self</span>):</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        epoch_average <span class="op">=</span> torch.stack(<span class="va">self</span>.test_step_outputs).mean()</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.log(<span class="st">"test_epoch_average"</span>, epoch_average)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_step_outputs.clear()</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> configure_optimizers(<span class="va">self</span>):</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        optimizer <span class="op">=</span> torch.optim.SGD(<span class="va">self</span>.parameters(), lr<span class="op">=</span>lr)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> optimizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DCP1
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
</section>
<section id="image-processing" class="level1">
<h1>Image Processing</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_augmentation_techniques.png" class="img-fluid figure-img"></p>
<figcaption>image processing techniques</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://arxiv.org/abs/2002.05709">A Simple Framework for Contrastive Learning of Visual Representations, Chen et al., ICML 2020</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="princeton_tiger_nobg.png" class="img-fluid figure-img"></p>
<figcaption>image processing</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://tigerlife.princeton.edu/sports">Princeton Sports</a></li>
</ul>
</section>
<section id="saliency-maps" class="level1">
<h1>Saliency Maps</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="saliency_maps.png" class="img-fluid figure-img"></p>
<figcaption>saliency maps</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://www.themoonlight.io/en/review/now-you-see-me-a-framework-for-obtaining-class-relevant-saliency-maps">Walter, et al</a></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DCP2
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
<section id="ethics-segment-voices" class="level1">
<h1>Ethics Segment: Voices</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Scene</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Cases</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Fallout</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>In 2025, New Era unveiled their lineup of fusion caps for baseball franchises.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="new_era_hats.png" class="img-fluid figure-img"></p>
<figcaption>New Era 2025 Hats</figcaption>
</figure>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>Some hats (such as this one from 2024) raised some concerns</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="new_era_hats_athletics.png" class="img-fluid figure-img"></p>
<figcaption>New Era 2024 Athletics</figcaption>
</figure>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<p>The company had to recall many of its products.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="new_era_hats_fallout.png" class="img-fluid figure-img"></p>
<figcaption>New Era 2025 fall out</figcaption>
</figure>
</div>
<ul>
<li>image credit: <a href="https://www.si.com/mlb/texas-rangers-new-era-hat-pulled-vulgarity">Sports Illustrated</a></li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DCP3
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
<section id="imagenet" class="level1">
<h1>ImageNet</h1>
<div class="columns">
<div class="column" style="width:45%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="worlds_I_see.png" class="img-fluid figure-img"></p>
<figcaption>The Worlds I See</figcaption>
</figure>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<ul>
<li>Dr Fei Fei Li</li>
<li>Princeton Class of 1999</li>
<li>Pre-Read Selection for Class of 2028</li>
</ul>
<blockquote class="blockquote">
<p>Biederman’s number: “30,000 unique concepts might provide a complete foundation for understanding the visual world”</p>
</blockquote>
<ul>
<li>ImageNet competition</li>
<li>AlexNet: solved by convolutional neural networks in 2012</li>
</ul>
</div>
</div>
<section id="image-augmentation" class="level2">
<h2 class="anchored" data-anchor-id="image-augmentation">Image Augmentation</h2>
<ul>
<li>rotation</li>
<li>translation</li>
<li>reflections</li>
<li>etc.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image_augmentation.png" class="img-fluid figure-img"></p>
<figcaption>image augmentation</figcaption>
</figure>
</div>
<ul>
<li>image source: <a href="https://nanonets.com/blog/data-augmentation-how-to-use-deep-learning-when-you-have-limited-data-part-2/">Arun Gandhi</a></li>
</ul>
</section>
</section>
<section id="quo-vadimus" class="level1">
<h1>Quo Vadimus?</h1>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><p>due this Friday (Oct 31):</p>
<ul>
<li>Precept 7 (1 hour)</li>
<li>Multipass: xLSTM (20 minutes)</li>
<li>Literature Search (10 minutes)</li>
</ul></li>
</ul>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:50%;">
<p>Our SML 301 lecture session for <strong>Monday, November 24</strong> will be remote (Zoom).</p>
<ul>
<li>guest speaker from AI industry</li>
</ul>
</div>
</div>
</section>
<section id="footnotes" class="level1">
<h1>Footnotes</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
(optional) Additional Resources and References
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://alexmoltzau.medium.com/pytorch-governance-and-history-2e5889b79dc1">Pytorch history</a> by Alex Moltzau</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Matrix products: default
  LAPACK version 3.12.1

locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] lubridate_1.9.4      forcats_1.0.0        stringr_1.5.1       
 [4] dplyr_1.1.4          purrr_1.1.0          readr_2.1.5         
 [7] tidyr_1.3.1          tibble_3.3.0         ggplot2_4.0.0       
[10] tidyverse_2.0.0      patchwork_1.3.1      palmerpenguins_0.1.1
[13] ggtext_0.1.2        

loaded via a namespace (and not attached):
 [1] Matrix_1.7-3       gtable_0.3.6       jsonlite_2.0.0     compiler_4.5.1    
 [5] tidyselect_1.2.1   Rcpp_1.1.0         xml2_1.3.8         png_0.1-8         
 [9] scales_1.4.0       yaml_2.3.10        fastmap_1.2.0      lattice_0.22-7    
[13] reticulate_1.43.0  R6_2.6.1           labeling_0.4.3     generics_0.1.4    
[17] knitr_1.50         htmlwidgets_1.6.4  tzdb_0.5.0         pillar_1.11.0     
[21] RColorBrewer_1.1-3 rlang_1.1.6        stringi_1.8.7      xfun_0.52         
[25] S7_0.2.0           timechange_0.3.0   cli_3.6.5          withr_3.0.2       
[29] magrittr_2.0.3     digest_0.6.37      grid_4.5.1         gridtext_0.1.5    
[33] rstudioapi_0.17.1  hms_1.1.3          lifecycle_1.0.4    vctrs_0.6.5       
[37] evaluate_1.0.4     glue_1.8.0         farver_2.1.2       rmarkdown_2.29    
[41] tools_4.5.1        pkgconfig_2.0.3    htmltools_0.5.8.1 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column" style="width:45%;">

</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">

</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"></ul>
<div class="tab-content">

</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>